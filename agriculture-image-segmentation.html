<!DOCTYPE html>
<html lang="en">

<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5F9Y9HC95G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5F9Y9HC95G');
</script>
<script data-ad-client="ca-pub-8325812071117232" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="Agricultural Image Segmentation">
    <meta property="og:type" content="blog">
  <title>Agricultural Image Segmentation</title>
<link rel="icon" type="image/png" href="/favicon.png"/>
  <!-- Favicon -->
    <link rel="shortcut icon" href="üìù">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index">
      <div class="Navbar__Btn"><span>üìù</span> <span>Home</span></div>
    </a>
                                                                                                                            <span class="Navbar__Delim">&centerdot;</span>
    <a href="about">
      <div class="Navbar__Btn"> <span>About</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="news">
      <div class="Navbar__Btn"> <span>News</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="projects">
      <div class="Navbar__Btn"> <span>Projects</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="apps">
      <div class="Navbar__Btn"> <span>Apps</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="notes">
      <div class="Navbar__Btn"> <span>Notes</span></div>
    </a>
          </nav>
  <header class="Header">
          <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <h1 class="Header__Title">Agricultural Image Segmentation</h1>
            <div class="DateTagBar">
                <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, Dec 2, 2020</span>
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
            <a href="tag/image segmentation">image segmentation</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--orange">
            <a href="tag/computer vision">computer vision</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/a851a76e9dbc4794b1b550d67ad5927f" class="PageRoot"><div id="https://www.notion.so/b243a534f39e4844b72259baf6281233" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe1316d22-f54f-4af7-bc96-acd60e23cddf%2FUntitled.png?width=949&amp;table=block&amp;id=b243a534-f39e-4844-b722-59baf6281233"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe1316d22-f54f-4af7-bc96-acd60e23cddf%2FUntitled.png?width=949&amp;table=block&amp;id=b243a534-f39e-4844-b722-59baf6281233" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h1 id="https://www.notion.so/d8f3a8475fb1440bad6747d30a808e01" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/d8f3a8475fb1440bad6747d30a808e01"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Data</span></span></h1><div id="https://www.notion.so/2d20463177734308831e4f2951320b08" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">1 image with 1800 x 1135 resolution and 60 channels</span></span></p></div><div id="https://www.notion.so/ce4b43805d9140be92136c8d445ced39" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F20ded986-ab09-47a0-86ab-8f334099fe96%2FUntitled.png?width=1117&amp;table=block&amp;id=ce4b4380-5d91-40be-9213-6c8d445ced39"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F20ded986-ab09-47a0-86ab-8f334099fe96%2FUntitled.png?width=1117&amp;table=block&amp;id=ce4b4380-5d91-40be-9213-6c8d445ced39" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/783c9e339d334924ab87f638d7c3f369" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">There are 60 bands given by images.tif. The labels data given by labels.tif. There are 8 labels ranging from 1 to 8. 0 value in the label image means no data label available for that pixel. So, it requires a loss function that ignores nodata label (0).</span></span></p></div><div id="https://www.notion.so/014e8c3c4cdc4feda820f819573824b4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Every Month 5 bands images were shot from agricultural land for 12 months. So, 5 bands * 12 = 60 bands. The 8 labels mean, 8 types of cropland. There is an assumption that the spectral signal of each crop type varies with bands and months.</span></span></p></div><div id="https://www.notion.so/27360d15f9ae474c84e08f253276ebb2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The goal of semantic segmentation is to produce a map of croplands. So, the output will be the same size of labels.tif, with all 0 (no labels) pixels classified into one of 8 classes.</span></span></p></div><div id="https://www.notion.so/f0ff46f4c3fe4ce0836819252a6d7b50" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0df09da3-a40c-42f8-8436-66cd01f0f9ba%2FUntitled.png?width=943&amp;table=block&amp;id=f0ff46f4-c3fe-4ce0-8368-19252a6d7b50"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0df09da3-a40c-42f8-8436-66cd01f0f9ba%2FUntitled.png?width=943&amp;table=block&amp;id=f0ff46f4-c3fe-4ce0-8368-19252a6d7b50" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/641138b6de5e4217ba03753990438378" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Labels: 1 ‚Üí Crop A, 2 ‚Üí Crop B, 3 ‚Üí Crop C, 4 ‚Üí Crop D, 6 ‚Üí Crop E, 7 ‚Üí Crop F, 8 ‚Üí Crop G</span></span></p></div><div id="https://www.notion.so/2ee7cd1b71dc495a8dbdcd124f1c0c75" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Sample images required for training and validation can be generated by patching with a sliding window. The size of the patches depends on the model to be applied. Input is a whole 60 bands image. If the model does not support the input of 60 bands image, it is reduced into 3 bands by PCA.</span></span></p></div><h1 id="https://www.notion.so/b5786b93b5034e05bf9285de650f2af0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/b5786b93b5034e05bf9285de650f2af0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Bag of tricks</span></span></h1><ol class="NumberedListWrapper"><li id="https://www.notion.so/44014ad22c3e4e9080e580d1851ed545" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Adaptive histogram equalization [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://towardsdatascience.com/histogram-equalization-5d1013626e64">ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/2274ccbdf8334badbda51c9580f5347c" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Image Augmentation with </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/albumentations-team/albumentations">Albumentations</a></span></span></li><li id="https://www.notion.so/189b77c7a4cb467da287d6d69479666c" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Normalized 3d numpy array - overall or channel-wise</span></span></li><li id="https://www.notion.so/0190699bbb5f4775bc44651c7a67c571" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">Label balancing - how? - sampler</span></span></li><li id="https://www.notion.so/7a9f3412563148b4a89ffdb6460c41e3" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">Try Fine-grained U-net (FG-Unet) architecture</span></span></li><li id="https://www.notion.so/ef3710219e7245afaebae87a38d7ee0c" class="NumberedList" value="6"><span class="SemanticStringArray"><span class="SemanticString">Add sobel edge detection logic in loss function</span></span></li><li id="https://www.notion.so/2aa8748981c44c1dbeb1e5abd8cf8415" class="NumberedList" value="7"><span class="SemanticStringArray"><span class="SemanticString">Try WDL instead of WBCE [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/killthekitten/kaggle-carvana-2017/blob/master/losses.py">Ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/ea7ccd1a000c49e0b1ba88c06d6f54d6" class="NumberedList" value="8"><span class="SemanticStringArray"><span class="SemanticString">How to add pixel weighting component [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/jaidevd/jaidevd.github.io/blob/source/blog/posts/code/weighted_loss_unet.py">Ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/587100ea9f1a445bb3cb6af78f8daf7e" class="NumberedList" value="9"><span class="SemanticStringArray"><span class="SemanticString">RGB Weight initialization scheme? [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/olgaliak/segmentation-unet-maskrcnn/blob/master/unet/model.py">Ref</a></span><span class="SemanticString">] [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://arxiv.org/abs/1801.05746">Ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/b8031ca1abaa43efb2213f67be21c3e1" class="NumberedList" value="10"><span class="SemanticStringArray"><span class="SemanticString">Baseline: Vanilla Deep UNet</span></span></li><li id="https://www.notion.so/c8d11226fab0411aaeb32501f7548cff" class="NumberedList" value="11"><span class="SemanticStringArray"><span class="SemanticString">+ Residual connection</span></span></li><li id="https://www.notion.so/3baa86be9fb74885a1b83acc990e9832" class="NumberedList" value="12"><span class="SemanticStringArray"><span class="SemanticString">+ Atrous convolutions</span></span></li><li id="https://www.notion.so/6054395d257a4b2a8bdbec0258de3ef2" class="NumberedList" value="13"><span class="SemanticStringArray"><span class="SemanticString">+ Pyramid scene parse pooling</span></span></li><li id="https://www.notion.so/ac44d60d017345c7872feb98479b04b2" class="NumberedList" value="14"><span class="SemanticStringArray"><span class="SemanticString">+ Multitask inference</span></span></li><li id="https://www.notion.so/a91cf63dc8f040c18708e30807d37f6c" class="NumberedList" value="15"><span class="SemanticStringArray"><span class="SemanticString">+ CRF post processing</span></span></li><li id="https://www.notion.so/bf45d671f3ea47e69a8ba50d85b12146" class="NumberedList" value="16"><span class="SemanticStringArray"><span class="SemanticString">+ Boundary sharpening</span></span></li><li id="https://www.notion.so/033513819dbd42fb939aaa11c430b029" class="NumberedList" value="17"><span class="SemanticStringArray"><span class="SemanticString">+ Fine grained Unet</span></span></li><li id="https://www.notion.so/943e89092169484aa67e70e8e3855e4f" class="NumberedList" value="18"><span class="SemanticStringArray"><span class="SemanticString">+ Late temporal fusion</span></span></li><li id="https://www.notion.so/5b0c9ab5fac949e48995f9d9f9dd0bc9" class="NumberedList" value="19"><span class="SemanticStringArray"><span class="SemanticString">+ Percentile normalization fitting</span></span></li><li id="https://www.notion.so/6aadc5603fdc4b4ba5216794a35437ea" class="NumberedList" value="20"><span class="SemanticStringArray"><span class="SemanticString">+ Patch normalization transform</span></span></li><li id="https://www.notion.so/01d9e3e4c82f4c729ef2e44e80eada0d" class="NumberedList" value="21"><span class="SemanticStringArray"><span class="SemanticString">+ Lower threshold (90%)</span></span></li><li id="https://www.notion.so/fa78a278023c4765a41645bbd46fddb2" class="NumberedList" value="22"><span class="SemanticStringArray"><span class="SemanticString">+ On fly patch generation</span></span></li><li id="https://www.notion.so/bd9bbf2652c14f76a760d35b954410cb" class="NumberedList" value="23"><span class="SemanticStringArray"><span class="SemanticString">+ Patch stitch averaging</span></span></li></ol><h3 id="https://www.notion.so/a2c8c48847bc48148f3e64b6460fa408" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/a2c8c48847bc48148f3e64b6460fa408"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Augmentation scheme</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/2169169fb8564742a6fcbb1a5585854c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Random rotation by 90 degrees</span></span></li><li id="https://www.notion.so/44879c161f57431c9f94627470ca877f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Horizontal and Vertical flip</span></span></li><li id="https://www.notion.so/e8318eaab8664a9a8b3862a22dd64d34" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Heavy Geometric Transformations</span></span></li><li id="https://www.notion.so/41d543cc17504a9cb9697172abd9f9f0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Random HSV</span></span></li><li id="https://www.notion.so/aea2b81767ee45358968736a4744edf4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Loss-less augmentation</span></span></li><li id="https://www.notion.so/2f64f2bf5f0641b3870dfd0c5ee4e9a7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Channel shuffling</span></span></li><li id="https://www.notion.so/7e4bb1b743564166a2fe4155386c3a50" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Data augmentation based on class frequency</span></span></li><li id="https://www.notion.so/2f307710be4f49fd892525594b9a2fd3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Apply gaussian noise</span></span></li><li id="https://www.notion.so/7e2c1dd102a74ff2974ed2f5456dd253" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Scale by a random factor from 0.8 to 1.2</span></span></li><li id="https://www.notion.so/f4a39b8e12f74311b009f2d7b3967be5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Brighness changing</span></span></li></ul><h3 id="https://www.notion.so/b8b623e56a8a44bfa8f0d33c9037c2fb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b8b623e56a8a44bfa8f0d33c9037c2fb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Loss functions</span></span></h3><details id="https://www.notion.so/541364f1b1d1487a8009ad0186265157" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">Ref images</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/884607ae248648b88de83eea6dc89a3e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F657ac98e-a12d-45a7-87c7-64dd79fc508f%2FUntitled.png?width=984&amp;table=block&amp;id=884607ae-2486-48b8-8de8-3eea6dc89a3e"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F657ac98e-a12d-45a7-87c7-64dd79fc508f%2FUntitled.png?width=984&amp;table=block&amp;id=884607ae-2486-48b8-8de8-3eea6dc89a3e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5b8c69d2c6a8434a8654224f2a3fe250" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9801a21c-6451-4e53-8fa3-e0b050a99eee%2FUntitled.png?width=984&amp;table=block&amp;id=5b8c69d2-c6a8-434a-8654-224f2a3fe250"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9801a21c-6451-4e53-8fa3-e0b050a99eee%2FUntitled.png?width=984&amp;table=block&amp;id=5b8c69d2-c6a8-434a-8654-224f2a3fe250" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b1dfcf5abe224a4b89a3829d8d2daee1" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9536f18a-ad44-443a-b651-f2fe381a9b0c%2FUntitled.png?width=1507&amp;table=block&amp;id=b1dfcf5a-be22-4a4b-89a3-829d8d2daee1"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9536f18a-ad44-443a-b651-f2fe381a9b0c%2FUntitled.png?width=1507&amp;table=block&amp;id=b1dfcf5a-be22-4a4b-89a3-829d8d2daee1" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></details><details id="https://www.notion.so/28eee608110447a98277efc6968a0a35" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">Code snippets</span></span></summary><div class="Toggle__Content"><pre id="https://www.notion.so/e3ad9d9b5d914d21940f211894cb4130" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">soft_dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> epsilon<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token triple-quoted-string string">''' 
    Soft dice loss calculation for arbitrary batch size, number of classes, and number of spatial dimensions.
    Assumes the `channels_last` format.
  
    # Arguments
        y_true: b x X x Y( x Z...) x c One hot encoding of ground truth
        y_pred: b x X x Y( x Z...) x c Network output, must sum to 1 over c channel (such as after softmax) 
        epsilon: Used for numerical stability to avoid divide by zero errors
    
    # References
        V-Net: Fully Convolutional Neural Networks for Volumetric Medical Image Segmentation 
        https://arxiv.org/abs/1606.04797
        More details on Dice loss formulation 
        https://mediatum.ub.tum.de/doc/1395260/1395260.pdf (page 72)
        
        Adapted from https://github.com/Lasagne/Recipes/issues/99#issuecomment-347775022
    '''</span>
    
    <span class="token comment"># skip the batch and class axis for calculating Dice score</span>
    axes <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_pred<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    numerator <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_pred <span class="token operator">*</span> y_true<span class="token punctuation">,</span> axes<span class="token punctuation">)</span>
    denominator <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_pred<span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_true<span class="token punctuation">)</span><span class="token punctuation">,</span> axes<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>numerator <span class="token operator">/</span> <span class="token punctuation">(</span>denominator <span class="token operator">+</span> epsilon<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># average over classes and batch</span></span></span></span></code></pre><pre id="https://www.notion.so/7a788cae045945bfb18c8f0c6e059136" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">jaccard_coef</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    intersection <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">*</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_ <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">+</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    jac <span class="token operator">=</span> <span class="token punctuation">(</span>intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>sum_ <span class="token operator">-</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">return</span> K<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>jac<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
  numerator <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true <span class="token operator">*</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  denominator <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true <span class="token operator">+</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">-</span> numerator <span class="token operator">/</span> denominator


<span class="token keyword">def</span> <span class="token function">focal_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    output <span class="token operator">/=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    eps <span class="token operator">=</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span>
    output <span class="token operator">=</span> K<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>output<span class="token punctuation">,</span> eps<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span> <span class="token operator">-</span> eps<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">-</span>K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>K<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token operator">-</span> output<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span> <span class="token operator">*</span> target <span class="token operator">*</span> K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span></code></pre><pre id="https://www.notion.so/f4cd8e65e0b24aeea4482ee20ae4b9ed" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">weighted_categorical_crossentropy</span><span class="token punctuation">(</span>weights<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    A weighted version of keras.objectives.categorical_crossentropy
    
    Variables:
        weights: numpy array of shape (C,) where C is the number of classes
    
    Usage:
        weights = np.array([0.5,2,10]) # Class one at 0.5, class 2 twice the normal weights, class 3 10x.
        loss = weighted_categorical_crossentropy(weights)
        model.compile(loss=loss,optimizer='adam')
    """</span>
    
    weights <span class="token operator">=</span> K<span class="token punctuation">.</span>variable<span class="token punctuation">(</span>weights<span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># scale predictions so that the class probas of each sample sum to 1</span>
        y_pred <span class="token operator">/=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment"># clip to prevent NaN's and Inf's</span>
        y_pred <span class="token operator">=</span> K<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># calc</span>
        loss <span class="token operator">=</span> y_true <span class="token operator">*</span> K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>y_pred<span class="token punctuation">)</span> <span class="token operator">*</span> weights
        loss <span class="token operator">=</span> <span class="token operator">-</span>K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> loss
    
    <span class="token keyword">return</span> loss</span></span></span></code></pre><pre id="https://www.notion.so/09422e96302b49ca99d3b087b47d3bb7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">dice_coeff</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    smooth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>
    <span class="token comment"># Flatten</span>
    y_true_f <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y_pred_f <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    intersection <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true_f <span class="token operator">*</span> y_pred_f<span class="token punctuation">)</span>
    score <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true_f<span class="token punctuation">)</span> <span class="token operator">+</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_pred_f<span class="token punctuation">)</span> <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">return</span> score

<span class="token keyword">def</span> <span class="token function">dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    loss <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> dice_coeff<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    <span class="token keyword">return</span> loss

<span class="token keyword">def</span> <span class="token function">bce_dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    loss <span class="token operator">=</span> losses<span class="token punctuation">.</span>binary_crossentropy<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span> <span class="token operator">+</span> dice_loss<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    <span class="token keyword">return</span> loss</span></span></span></code></pre><pre id="https://www.notion.so/2ae8728942a2438eadc67acdd893b7ed" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>_EPSILON <span class="token operator">=</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span>
nb_class<span class="token operator">=</span><span class="token number">9</span> <span class="token comment"># number of objects plus the background</span>
<span class="token keyword">def</span> <span class="token function">custom_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
  y_pred <span class="token operator">=</span> K<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> _EPSILON<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">-</span>_EPSILON<span class="token punctuation">)</span>

  <span class="token comment"># find predictions</span>
  pred<span class="token operator">=</span>K<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment"># find missing annotations per class</span>
  y_trueAny<span class="token operator">=</span>K<span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token comment">#print "missing annotations",K.eval(y_trueAny)</span>

  backgroundWeights<span class="token operator">=</span><span class="token number">1</span>
  <span class="token keyword">for</span> cls <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>nb_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token comment"># we use repeat to get the same size as other tensors</span>
      y_trueAnyRepeat<span class="token operator">=</span>K<span class="token punctuation">.</span>repeat_elements<span class="token punctuation">(</span>y_trueAny<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>cls<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token comment">#print "repeat shape",K.eval(K.shape(y_trueAnyRepeat))</span>
      
      <span class="token comment"># check for two conditions</span>
      <span class="token comment"># 1- annotation missing</span>
      <span class="token comment"># 2- prediction is equal to missing class/object</span>
      backgroundWeights<span class="token operator">*=</span>K<span class="token punctuation">.</span>not_equal<span class="token punctuation">(</span>pred<span class="token punctuation">,</span>cls<span class="token punctuation">)</span><span class="token operator">+</span>y_trueAnyRepeat
      <span class="token comment">#print "background weights shape",K.eval(K.shape(backgroundWeights)),K.eval(K.shape(pred))</span>
      <span class="token comment">#print "sum of background weights",cls,K.eval(K.sum(backgroundWeig0.191179hts))</span>

  <span class="token comment"># loss for background</span>
  loss<span class="token operator">=</span>backgroundWeights<span class="token operator">*</span>y_true<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>y_pred<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> cls <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>nb_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
      loss<span class="token operator">+=</span>y_true<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>cls<span class="token punctuation">]</span><span class="token operator">*</span>K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>y_pred<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>cls<span class="token punctuation">]</span><span class="token punctuation">)</span>
      
  <span class="token keyword">return</span> <span class="token operator">-</span>loss</span></span></span></code></pre><pre id="https://www.notion.so/11dea6c8f32d4ac4a9e04f20ac0b7189" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">dice_coef_rb</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> smooth<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_true <span class="token operator">=</span> K<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> <span class="token string">'int32'</span><span class="token punctuation">)</span>
    y_true <span class="token operator">=</span> K<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>y_true<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    y_pred <span class="token operator">=</span> y_pred<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    intersection <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">*</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_ <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">+</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> K<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>sum_ <span class="token operator">+</span> smooth<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">dice_coef_loss_rb</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">-</span> dice_coef_rb<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span></span></span></code></pre></div></details><ol class="NumberedListWrapper"><li id="https://www.notion.so/c32e7624f49d498eb033be9324e149f9" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Dice loss</span></span></li><li id="https://www.notion.so/ec50305f2e7d4cf4b8227c5b2fdc0d94" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Class weights</span></span></li><li id="https://www.notion.so/628619271a6640919582e4ecdae9b34b" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Pixel weighted (weighted boundary loss - </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.kaggle.com/lyakaap/weighing-boundary-pixels-loss-script-by-keras2">code</a></span><span class="SemanticString">)</span></span></li><li id="https://www.notion.so/42fa73700f2547fa98220ad64b30e6fb" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">Combination of BCE, Dice and Focal</span></span></li></ol><h3 id="https://www.notion.so/83f3af4e65ed40be902a63412cbfa0b9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/83f3af4e65ed40be902a63412cbfa0b9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Hyperparameters</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/7c197dd120564d6aa025cbbd4e89284e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Binary class vs. Multiclass</span></span></li><li id="https://www.notion.so/fa3e4e69a9eb46ca86f1eb43eb494202" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Standardisation channel-wise or image-wise</span></span></li><li id="https://www.notion.so/6621d0e64e7d4fec969e9238fb864754" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Class weights</span></span></li><li id="https://www.notion.so/806824c45aff4248b856f2af68f92006" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Patch-based vs. Stride</span></span></li><li id="https://www.notion.so/656bcbaf9f7a4de38fd1b122169200d2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Augmentation</span></span></li><li id="https://www.notion.so/0041757dfbf0412d8b0872ae75db1872" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">U-net model architecture</span></span></li><li id="https://www.notion.so/9197ea2454504558afe5abcbdaba6aab" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Loss function</span></span></li></ul><h1 id="https://www.notion.so/4068dfa822484bd58c3fe24d9cdebc86" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/4068dfa822484bd58c3fe24d9cdebc86"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Results and Discussion</span></span></h1><div id="https://www.notion.so/eaccccd2943b4bdca1421d3db81ba059" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4312e869-4afd-4018-955f-e36ece5ae8f6%2FUntitled.png?width=851&amp;table=block&amp;id=eaccccd2-943b-4bdc-a142-1d3db81ba059"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4312e869-4afd-4018-955f-e36ece5ae8f6%2FUntitled.png?width=851&amp;table=block&amp;id=eaccccd2-943b-4bdc-a142-1d3db81ba059" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/090d54f6cfb240649a5e130eee3206a4" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc491844a-d08e-43ea-9133-a131ffdc2bfe%2FUntitled.png?width=851&amp;table=block&amp;id=090d54f6-cfb2-4064-9a5e-130eee3206a4"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc491844a-d08e-43ea-9133-a131ffdc2bfe%2FUntitled.png?width=851&amp;table=block&amp;id=090d54f6-cfb2-4064-9a5e-130eee3206a4" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/20851d79614d432587ce12d58929559a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa03315f2-d315-45f7-9f63-0c4db16f161b%2FUntitled.png?width=851&amp;table=block&amp;id=20851d79-614d-4325-87ce-12d58929559a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa03315f2-d315-45f7-9f63-0c4db16f161b%2FUntitled.png?width=851&amp;table=block&amp;id=20851d79-614d-4325-87ce-12d58929559a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/da17724272954a56b3316d9e96dd4033" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8278fa73-59f5-4220-baf6-3e4ad28b294f%2FUntitled.png?width=851&amp;table=block&amp;id=da177242-7295-4a56-b331-6d9e96dd4033"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8278fa73-59f5-4220-baf6-3e4ad28b294f%2FUntitled.png?width=851&amp;table=block&amp;id=da177242-7295-4a56-b331-6d9e96dd4033" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a5d9f0b1cd514002830fc7db09dbc687" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa3e08bad-91f0-4fa8-b009-3b395e44b5ab%2FUntitled.png?width=851&amp;table=block&amp;id=a5d9f0b1-cd51-4002-830f-c7db09dbc687"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa3e08bad-91f0-4fa8-b009-3b395e44b5ab%2FUntitled.png?width=851&amp;table=block&amp;id=a5d9f0b1-cd51-4002-830f-c7db09dbc687" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></article>  <footer class="Footer">
        <div>&copy; Blog Posts 2019</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>